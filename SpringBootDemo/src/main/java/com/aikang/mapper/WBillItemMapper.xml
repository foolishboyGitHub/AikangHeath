<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.aikang.mapper.WBillItemMapper">
	<resultMap id="BaseResultMap" type="com.aikang.Bean.WBillItem">
        <id column="id" property="id" jdbcType="INTEGER"/>
        <result column="rmid" property="rmid" jdbcType="INTEGER"/>
        <result column="rmname" property="rmname" jdbcType="VARCHAR"/>
        <result column="wtype" property="wtype" jdbcType="INTEGER"/>
        <result column="dayid" property="dayid" jdbcType="INTEGER"/>
        <result column="daynum" property="daynum" jdbcType="INTEGER"/>
        <result column="sid" property="sid" jdbcType="INTEGER"/>
        <result column="sname" property="sname" jdbcType="VARCHAR"/>
        <result column="hid" property="hid" jdbcType="INTEGER"/>
        <result column="hcode" property="hcode" jdbcType="VARCHAR"/>
        <result column="hname" property="hname" jdbcType="VARCHAR"/>
        <result column="workstate" property="workstate" jdbcType="INTEGER"/>
        <result column="changenum" property="changenum" jdbcType="INTEGER"/>
        <result column="changelist" property="changelist" jdbcType="VARCHAR"/>
        <result column="maketime" property="maketime" jdbcType="VARCHAR"/>
        <result column="waittime" property="waittime" jdbcType="VARCHAR"/>
        <result column="worktime" property="worktime" jdbcType="VARCHAR"/>
        <result column="breakstart" property="breakstart" jdbcType="VARCHAR"/>
        <result column="breaklong" property="breaklong" jdbcType="INTEGER"/>
        <result column="finishtime" property="finishtime" jdbcType="VARCHAR"/>
        <result column="remark" property="remark" jdbcType="VARCHAR"/>
        <result column="kid" property="kid" jdbcType="BIGINT"/>
        <result column="kname" property="kname" jdbcType="VARCHAR"/>
		<result column="paystate" property="paystate" jdbcType="INTEGER"/>
		<result column="paynum" property="paynum" jdbcType="INTEGER"/>
		<result column="payid" property="payid" jdbcType="BIGINT"/>
		<result column="checkcode" property="checkcode" jdbcType="VARCHAR"/>
		<result column="enabled" property="enabled" jdbcType="INTEGER"/>
		<result column="worksalary" property="worksalary" jdbcType="DOUBLE"/>
		<result column="clocknum" property="clocknum" jdbcType="DOUBLE"/>
		<result column="clocknumzs" property="clocknumzs" jdbcType="DOUBLE"/>
		<result column="itembill" property="itembill" jdbcType="DOUBLE"/>
		<result column="pricetype" property="pricetype" jdbcType="VARCHAR"/>
		<result column="memid" property="memid" jdbcType="BIGINT"/>
		<result column="memname" property="memname" jdbcType="VARCHAR"/>
		<result column="memcode" property="memcode" jdbcType="VARCHAR"/>
		<result column="checkid" property="checkid" jdbcType="VARCHAR"/>
		<result column="checkname" property="checkname" jdbcType="VARCHAR"/>
		<result column="checkhcode" property="checkhcode" jdbcType="VARCHAR"/>
		<result column="checktime" property="checktime" jdbcType="VARCHAR"/>
    </resultMap>
    <select id="getAllWBillItem" resultMap="BaseResultMap" statementType="PREPARED">
        select wi.* from ${company}_wbillitem wi order by wi.dayid
    </select>
    <select id="getBillItemsByHid" resultMap="BaseResultMap" statementType="PREPARED">
        select wi.id,wi.rmid,wi.rmname,wi.wtype,wi.dayid,wi.sid,wi.sname,wi.hid,wi.hcode,wi.hname,
        wi.workstate,wi.worktime,wi.waittime,wi.breakstart,wi.breaklong,wi.finishtime
        from ${company}_wbillitem wi 
        where hid=#{hid}
        order by wi.dayid
    </select>
    <select id="getCompanyBillItemById" resultMap="BaseResultMap" statementType="PREPARED">
        select wi.* from ${company}_wbillitem wi
        where id=#{id}
    </select>
    <select id="getCompanyWBillItemByIds" resultMap="BaseResultMap" statementType="PREPARED">
        select wi.* from ${company}_wbillitem wi 
        where id in
        <foreach collection="ids" item="item" open="(" close=")" separator=",">
        	#{item}
        </foreach>
        order by wi.dayid
    </select>
    
    <select id="queryBillSummarySpanDay" resultType="java.util.HashMap"
		parameterType="java.util.HashMap">
		SELECT 
		COALESCE(SUM(itembill),0) as money,
		COALESCE(SUM(worksalary),0) as salary
		FROM ${company}_wbillitem
		where <![CDATA[daynum>=#{query.qs} ]]>  and <![CDATA[daynum < #{query.qe} ]]>
	</select>
	
	<select id="queryAllWorksServiceSpanDay" resultType="java.util.HashMap"
		parameterType="java.util.HashMap">
		SELECT 
		any_value(hid) as hid,
		any_value(sname) as sname,
		any_value(hname) as hname,
		any_value(hcode) as hcode,
		any_value(wtype) as wtype,
		COALESCE(SUM(clocknumzs),0) as clocknum,
		COALESCE(SUM(worksalary),0) as salary
		FROM ${company}_wbillitem
		where <![CDATA[daynum>=#{query.qs} ]]>  and <![CDATA[daynum < #{query.qe} ]]>
		<if test="query.qh >= 0">
            and hid = #{query.qh}
        </if>
		GROUP BY hid,sname,wtype WITH rollup
	</select>
    <select id="queryAllWorksDetailsSpanDay" resultType="java.util.HashMap"
		parameterType="java.util.HashMap">
		SELECT
		id,
		rmname, 
		hid,
		sname,
		hname,
		hcode,
		wtype,
		clocknum,
		clocknumzs,
		worksalary,
		itembill,
		pricetype,
		memname,
		memcode,
		checktime
		FROM ${company}_wbillitem
		where <![CDATA[daynum>=#{query.qs} ]]>  and <![CDATA[daynum < #{query.qe} ]]>
		<if test="query.qh >= 0">
            and hid = #{query.qh}
        </if>
	</select>
    <insert id="insertWBillItems" parameterType="com.aikang.Bean.WBillItem" useGeneratedKeys="true" keyProperty="record.id" keyColumn="id" statementType="PREPARED">
    insert into ${company}_wbillitem 
    (
    	rmid,
    	rmname,
    	wtype,
    	dayid,
    	daynum,
    	sid, 
    	sname, 
    	hid, 
    	hcode, 
      	hname, 
      	workstate,
      	changenum, 
      	changelist,
      	maketime, 
      	waittime, 
      	worktime, 
      	breakstart, 
      	breaklong, 
      	finishtime, 
      	remark, 
      	kid, 
      	kname, 
      	paystate,
      	paynum, 
      	payid, 
      	checkcode,
      	enabled,
		worksalary,
		clocknum,
		clocknumzs,
		itembill,
		pricetype,
		memid,
		memname,
		memcode,
		checkid,   
		checkname,
		checkhcode,
		checktime
    )
    values 
    <foreach collection="record" item="WBillItem" separator=","> 
      (
      #{WBillItem.rmid,jdbcType=INTEGER},
      #{WBillItem.rmname,jdbcType=VARCHAR},
      #{WBillItem.wtype,jdbcType=INTEGER}, 
      #{WBillItem.dayid,jdbcType=INTEGER}, 
      #{WBillItem.daynum,jdbcType=INTEGER}, 
      #{WBillItem.sid,jdbcType=INTEGER}, 
      #{WBillItem.sname,jdbcType=VARCHAR}, 
      #{WBillItem.hid,jdbcType=INTEGER},
      #{WBillItem.hcode,jdbcType=VARCHAR}, 
      #{WBillItem.hname,jdbcType=VARCHAR}, 
      #{WBillItem.workstate,jdbcType=INTEGER}, 
      #{WBillItem.changenum,jdbcType=INTEGER}, 
      #{WBillItem.changelist,jdbcType=VARCHAR},
      #{WBillItem.maketime,jdbcType=VARCHAR}, 
      #{WBillItem.waittime,jdbcType=VARCHAR}, 
      #{WBillItem.worktime,jdbcType=VARCHAR}, 
      #{WBillItem.breakstart,jdbcType=VARCHAR}, 
      #{WBillItem.breaklong,jdbcType=INTEGER}, 
      #{WBillItem.finishtime,jdbcType=VARCHAR}, 
      #{WBillItem.remark,jdbcType=VARCHAR},
      #{WBillItem.kid,jdbcType=BIGINT},
      #{WBillItem.kname,jdbcType=VARCHAR},
      #{WBillItem.paystate,jdbcType=INTEGER},
      #{WBillItem.paynum,jdbcType=INTEGER},
      #{WBillItem.payid,jdbcType=BIGINT},
      #{WBillItem.checkcode,jdbcType=VARCHAR},
      #{WBillItem.enabled,jdbcType=INTEGER},
      #{WBillItem.worksalary,jdbcType=DOUBLE},
      #{WBillItem.clocknum,jdbcType=DOUBLE},
      #{WBillItem.clocknumzs,jdbcType=DOUBLE},
      #{WBillItem.itembill,jdbcType=DOUBLE},
      #{WBillItem.pricetype,jdbcType=VARCHAR},
      #{WBillItem.memid,jdbcType=BIGINT},
      #{WBillItem.memname,jdbcType=VARCHAR},
      #{WBillItem.memcode,jdbcType=VARCHAR},
      #{WBillItem.checkid,jdbcType=VARCHAR},
      #{WBillItem.checkname,jdbcType=VARCHAR},
      #{WBillItem.checkhcode,jdbcType=VARCHAR},
      #{WBillItem.checktime,jdbcType=VARCHAR}
      )
     </foreach>
  </insert>

  <update id="updateWaiterStateListByIdSelective"  parameterType="java.util.List" statementType="PREPARED">
      update ${company}_wbillitem
      <trim prefix="set" suffixOverrides=",">
        <trim prefix="workstate = case" suffix="end,">
          <foreach collection="record" item="WBillItem">
            <if test="WBillItem.workstate != null">
              when id=#{WBillItem.id} then #{WBillItem.workstate}
            </if>
          </foreach>
        </trim>
      </trim>
      where
        <foreach collection="record" item="WBillItem" separator="or">
            id = #{WBillItem.id}
        </foreach>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="com.aikang.Bean.WBillItem" statementType="PREPARED">
        update ${company}_wbillitem
        <set>      
            <if test="record.rmid != null">
                rmid = #{record.rmid,jdbcType=INTEGER},
            </if>
            <if test="record.rmname != null">
                rmname = #{record.rmname,jdbcType=VARCHAR},
            </if>
            <if test="record.wtype != null">
                wtype = #{record.wtype,jdbcType=INTEGER},
            </if>
            <if test="record.dayid != null">
                dayid = #{record.dayid,jdbcType=INTEGER},
            </if>
            <if test="record.daynum != null">
                daynum = #{record.daynum,jdbcType=INTEGER},
            </if>
            <if test="record.sid != null">
                sid = #{record.sid,jdbcType=INTEGER},
            </if>
      		<if test="record.sname != null">
                sname = #{record.sname,jdbcType=VARCHAR},
            </if> 
      		<if test="record.hid != null">
                hid = #{record.hid,jdbcType=INTEGER},
            </if>
            <if test="record.hcode != null">
                hcode = #{record.hcode,jdbcType=INTEGER},
            </if> 
      		<if test="record.hname != null">
                hname = #{record.hname,jdbcType=VARCHAR}, 
            </if>
      		<if test="record.workstate != null">
                workstate = #{record.workstate,jdbcType=VARCHAR},
            </if> 
      		<if test="record.changenum != null">
                changenum = #{record.changenum,jdbcType=INTEGER},
            </if> 
      		<if test="record.changelist != null">
                changelist = #{record.changelist,jdbcType=VARCHAR}, 
            </if>
            <if test="record.maketime != null">
                maketime = #{record.maketime,jdbcType=VARCHAR},
            </if> 
      		<if test="record.waittime != null">
                waittime = #{record.waittime,jdbcType=VARCHAR},
            </if> 
      		<if test="record.worktime != null">
                worktime = #{record.worktime,jdbcType=VARCHAR}, 
            </if>
      		<if test="record.breakstart != null">
                breakstart = #{record.breakstart,jdbcType=VARCHAR}, 
            </if>
      		<if test="record.breaklong != null">
                breaklong = #{record.breaklong,jdbcType=INTEGER}, 
            </if>
      		<if test="record.finishtime != null">
                finishtime = #{record.finishtime,jdbcType=VARCHAR},
            </if> 
      		<if test="record.remark != null">
                remark = #{record.remark,jdbcType=VARCHAR},
            </if>
      		<if test="record.kid != null">
                kid = #{record.kid,jdbcType=BIGINT},
            </if>
      		<if test="record.kname != null">
                kname = #{record.kname,jdbcType=VARCHAR},
            </if>
      		<if test="record.paystate != null">
                paystate = #{record.paystate,jdbcType=INTEGER},
            </if>
      		<if test="record.paynum != null">
                paynum = #{record.paynum,jdbcType=INTEGER},
      		</if>
      		<if test="record.payid != null">
                payid = #{record.payid,jdbcType=BIGINT},
      		</if>
      		<if test="record.checkcode != null">
                checkcode = #{record.checkcode,jdbcType=VARCHAR},
      		</if>		
      		<if test="record.enabled != null">
                enabled = #{record.enabled,jdbcType=INTEGER},
      		</if>
      		<if test="record.worksalary != null">
                worksalary = #{record.worksalary,jdbcType=DOUBLE},
      		</if>
      		<if test="record.clocknum != null">
                clocknum = #{record.clocknum,jdbcType=DOUBLE},
      		</if>
      		<if test="record.clocknumzs != null">
                clocknumzs = #{record.clocknumzs,jdbcType=DOUBLE},
      		</if>
      		<if test="record.itembill != null">
                itembill = #{record.itembill,jdbcType=VARCHAR},
      		</if>
      		<if test="record.pricetype != null">
                pricetype = #{record.pricetype,jdbcType=VARCHAR},
      		</if>
      		<if test="record.memid != null">
                memid = #{record.memid,jdbcType=BIGINT},
      		</if>
      		<if test="record.memname != null">
                memname = #{record.memname,jdbcType=VARCHAR},
      		</if>
      		<if test="record.memcode != null">
                memcode = #{record.memcode,jdbcType=VARCHAR},
      		</if>
      		<if test="record.checkid != null">
                checkid = #{record.checkid,jdbcType=VARCHAR},
      		</if>
      		<if test="record.checkname != null">
                checkname = #{record.checkname,jdbcType=VARCHAR},
      		</if>
      		<if test="record.checkhcode != null">
                checkhcode = #{record.checkhcode,jdbcType=VARCHAR},
      		</if>
      		<if test="record.checktime != null">
                checktime = #{record.checktime,jdbcType=VARCHAR},
      		</if>

        </set>
        where id = #{record.id,jdbcType=INTEGER}
    </update>
  	<delete id="deleteWBillItemByID">
    	delete from ${company}_wbillitem where id=#{id}
  	</delete>
</mapper>